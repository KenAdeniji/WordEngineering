<!DOCTYPE html>
<html lang="en">
	<head>
		<!--
			2025-08-28T20:42:00	http://frontendmasters.com/blog/using-the-custom-highlight-api
		-->
		<title>Using the Custom Highlight API by Chris Coyier on 2025-08-07</title>
		<meta charset="UTF-8"/>
		<meta name="description" content="Using the Custom Highlight API by Chris Coyier on 2025-08-07"/>
		<meta name="keywords" content="Custom Highlight API, Chris Coyier"/>
		<meta name="robots" content="index, follow"/>
		<meta name="author" content="Ken Adeniji"/>
	</head>
	<body>
		<label>
			Search the text below
			<input type="search" value="oven" id="searchTerm">
		</label>
		<p>
The pizza oven was very hot and it burned the pizza. But the pizza was delicious anyway, I don't blame the oven.		
		</p>
		<style>
::highlight(search-results) {
  color: orange;

  /* limits on what you can style */
  /* font-weight: bold; */
}

html {
  color-scheme: dark light;
  background: Canvas;
  color: CanvasText;
  font: 170%/1.4 system-ui, sans-serif;
}

body {
  margin: 0;
  padding: 2rem;
}

label {
  display: block;
  font-size: 60%;
  input {
    display: block;
    font: inherit;
  }
}			
		</style>
		<script>
const NAME_OF_HIGHLIGHT = "search-results";

window.searchTerm.addEventListener("input", (e) => {
  doSearch(e.target.value.toLowerCase());
})

function doSearch(searchTerm) {
  // Find all the matches, not just one.
  const regex = new RegExp(searchTerm, "gi");

  // We need an array of indexes of where the matches were found. e.g. where the match starts.
  const indexes = [...theTextContent.matchAll(new RegExp(searchTerm, 'gi'))].map(a => a.index);

  // We'll make our own array of ranges that we'll spread into a new Highlight
  const arrayOfRanges = [];
  
  indexes.forEach(matchIndex => {
    // Make a "Range" out of the index values.
    const searchRange = new Range();
    searchRange.setStart(par, matchIndex);
    searchRange.setEnd(par, matchIndex + searchTerm.length);
  
    arrayOfRanges.push(searchRange);
  })
  
  const ourHighlight = new Highlight(...arrayOfRanges);
    
  // Make a "Highlight", so CSS can touch it, out of the Range
  CSS.highlights.set(NAME_OF_HIGHLIGHT, ourHighlight);
}

// We need the textNode within the <p>, not just the <p>.
const par = document.querySelector("p").firstChild;

// Thennnnn we need the textContent of it in order to search it.
const theTextContent = par.textContent.toLowerCase();

doSearch("oven");		
		</script>
	</body>
</html>
